<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoice • PMS</title>
  <link rel="stylesheet" href="../assets/styles.css" />
</head>
<body>
  <div class="topbar">
    <div class="container">
      <nav class="nav">
        <a href="../pages/login.html" data-page="login">Login</a>
        <a href="../pages/register.html" data-page="register" data-role-only="customer">Register</a>

        <a href="../pages/customer-home.html" data-page="customer-home" data-role-only="customer">Home (Customer)</a>
        <a href="../pages/officer-home.html" data-page="officer-home" data-role-only="officer">Home (Officer)</a>

        <a href="../pages/booking-customer.html" data-page="booking-customer" data-role-only="customer">Booking Service</a>
        <a href="../pages/booking-officer.html" data-page="booking-officer" data-role-only="officer">Booking Service</a>

        <a href="../pages/tracking-customer.html" data-page="tracking-customer" data-role-only="customer">Tracking</a>
        <a href="../pages/tracking-officer.html" data-page="tracking-officer" data-role-only="officer">Tracking</a>

        <a href="../pages/booking-history-customer.html" data-page="history-customer" data-role-only="customer">Previous Booking</a>
        <a href="../pages/booking-history-officer.html" data-page="history-officer" data-role-only="officer">Booking History</a>

        <a href="../pages/pickup-scheduling.html" data-page="pickup" data-role-only="officer">Pickup Scheduling</a>
        <a href="../pages/delivery-update.html" data-page="delivery" data-role-only="officer">Delivery Update</a>

        <a href="../pages/support.html" data-page="support">Contact Support</a>

        <div class="right">
          <span id="welcomeUser" class="muted"></span>
          <button id="logoutBtn" class="btn-secondary">Logout</button>
        </div>
      </nav>
    </div>
  </div>

  <main class="container grid">
    <div id="alertHost"></div>
    
<section class="card">
  <div class="spread">
    <div>
      <h1>Invoice</h1>
      <p class="muted">Read-only invoice with Print option.</p>
    </div>
    <div class="row">
      <button id="printBtn" class="btn-secondary">Print</button>
      <a class="btn" href="../pages/tracking-customer.html">Track Booking</a>
    </div>
  </div>
  <hr />

  <div id="invoiceBox" class="card" style="padding:14px">
    <p class="muted">No invoice found.</p>
  </div>
</section>

    <div class="footer">Parcel Management System UI • HTML/CSS/JS (localStorage demo)</div>
  </main>

  <script src="../assets/app.js"></script>
  <script>
    ensureSeed();
    const __page = "invoice";
    // login/register don't require auth
    if(!["login","register"].includes(__page)) {
      requireAuth();
    }
    setupNav(__page);
  </script>
  
<script>
  requireAuth();
  const bookingId = load("pms_last_paid_booking_id_v1", null);
  const all = bookings();
  const b = all.find(x => x.bookingId === bookingId) || all[0];

  const box = document.getElementById("invoiceBox");
  if(!b){
    box.innerHTML = '<p class="muted">No invoice found. Make a payment first.</p>';
  } else {
    box.innerHTML = `
      <div class="row" style="justify-content:space-between">
        <span class="badge">Booking ID: <b>${escapeHtml(b.bookingId)}</b></span>
        <span class="muted">Payment Time: ${escapeHtml(new Date(b.payment.paidAt).toLocaleString())}</span>
      </div>
      <hr />
      <div class="kv">
        <div>Receiver Name</div><div>${escapeHtml(b.receiver.name)}</div>
        <div>Receiver Address</div><div>${escapeHtml(b.receiver.address)}</div>
        <div>Receiver Pin</div><div>${escapeHtml(b.receiver.pin)}</div>
        <div>Receiver Mobile</div><div>${escapeHtml(b.receiver.phone)}</div>

        <div>Parcel Weight (g)</div><div>${escapeHtml(Math.round((b.parcel.weightKg||0)*1000))}</div>
        <div>Parcel Contents Description</div><div>${escapeHtml(b.parcel.description)}</div>
        <div>Parcel Delivery Type</div><div>${escapeHtml(b.shipping.speed)}</div>
        <div>Parcel Packing Preference</div><div>${escapeHtml(b.shipping.packaging)}</div>
        <div>Parcel Pickup Time</div><div>${escapeHtml(formatDateTimeLocal(b.shipping.pickupTime))}</div>
        <div>Parcel Dropoff Time</div><div>${escapeHtml(formatDateTimeLocal(b.shipping.dropoffTime))}</div>

        <div>Parcel Service Cost</div><div>₹ ${escapeHtml(b.payment.amount)}</div>
        <div>Parcel Payment Time</div><div>${escapeHtml(new Date(b.payment.paidAt).toLocaleString())}</div>
      </div>
    `;
  }

  document.getElementById("printBtn").addEventListener("click", ()=> window.print());
</script>

</body>
</html>
